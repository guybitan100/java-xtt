<test>
<name>Decoration.TC.002</name>
	<description>[Archive Decoration]Validate various decoration types for archive services / Sender of an MMS message has activated archive service / Subject, Message ID and transaction ID decorations are decorated by application and detected by proxy
Test Category: MUST
Test Steps:
---------------------------------------------------------------
. Sender of an MMS message activates archive service through Web Portal.
2. Send MM1 message to MMS Proxy.
3. MMS Proxy should intercept this message and send "New-Message-Intercepted" Request to Application as HTTP GET Request.
4. MMS Extra after validating the user and recipient sends a positive response and asks for "send data" to MMS Proxy server.
5. MMS Proxy then sends HTTP post with having body in message
6. Sender credit balance has been checked, if the sender has balance then the request get forwarded.
7. Application Archive the messages send in sender outbox.
8. MM7 Submit has been sent via MM7-OUT to the target recipient.
9. Application gets a 200 ok response.
10. Billing for that sender happens. 
---------------------------------------------------------------
<!--  Modules Used:
	  1. HTTP
	  2. Remote
	  3. Basic -->
</description>  
	<!-- Start MMSC server -->
	<function name="startMMSCServer" module="MMSC"/>

	<!-- Available MSISDN -->
	<configuration>../subscriber_config.xml</configuration>

	<!-- Delete Message Store -->
	<subtest>../deleteMessageStoreAll.xml</subtest>

	<!-- Set mandatory headers -->
	<function name="setHeader" module="HTTP">
		<parameter>X-Proxy-Region</parameter>
		<parameter>Siberia</parameter>
	</function>

	<function name="setHeader" module="HTTP">
		<parameter>X-Proxy-Session-Id</parameter>
		<parameter>987654</parameter>
	</function>

	<function name="setHeader" module="HTTP">
		<parameter>X-Proxy-MMS-Message-Type</parameter>
		<parameter>m-send-req</parameter>
	</function>

	<!-- Set recipient address -->
	<function name="setHeader" module="HTTP">
		<parameter>To</parameter>
		<configuration>MMSX/ARCHIVE/RECIPIENT/MSISDN1</configuration>
	</function>

	<!-- Set Sender Address -->
	<function name="setHeader" module="HTTP">
		<parameter>X-Proxy-Subscriber-MSISDN</parameter>
		<configuration>MMSX/ARCHIVE/SENDER/MSISDN1</configuration>
	</function>

	<!-- Set Subject for request-->
	<function name="setHeader" module="HTTP">
		<parameter>Subject</parameter>
		<parameter>This is a test message </parameter>
	</function>

	<!-- Send Metadeta  Request to application-->
	<function name="sendGetRequest" module="HTTP">
		<parameter>
			<parameter>http://</parameter>
			<configuration>MMS_Extra/IP</configuration>
			<parameter>:</parameter>
			<configuration>MMS_Extra/PORT</configuration>
			<parameter>/New-Message-Intercepted</parameter>
		</parameter>
	</function>

	<!-- Check response received from application -->
	<function name="checkResponseCode" module="HTTP">
		<parameter>200</parameter>
	</function>

	<function name="checkHeader" module="HTTP">
		<parameter>X-Proxy-Handle</parameter>
		<parameter>send-body</parameter>
	</function>

	<function name="queryText" module="BASIC">
		<variable>HTTP/HEADER/x-application-context-id</variable>
		<parameter>X-Application-Context-Id</parameter>
		<parameter>(.*)</parameter>
	</function>

	<function name="info" module="Basic">
		<parameter>X-Application-Context-Id=</parameter>
		<variable>X-Application-Context-Id</variable>
	</function>

	<function name="setHeader" module="HTTP">
		<parameter>X-Application-Context-Id</parameter>
		<variable>X-Application-Context-Id</variable>
	</function>

	<function name="setHeader" module="HTTP">
		<parameter>Content-Type</parameter>
		<parameter>text/xml; charset="utf-8"; boundary="NextPart_000_0028_01C19839.84698430"</parameter>
	</function>

	<function name="setPostData" module="HTTP">
		<file>mm7req.txt</file>
		<parameter/>
	</function>

	<!-- Send Body to application -->
	<function name="sendPostRequest" module="HTTP">
		<parameter>
			<parameter>http://</parameter>
			<configuration>MMS_Extra/IP</configuration>
			<parameter>:</parameter>
			<configuration>MMS_Extra/PORT</configuration>
			<parameter>/Message-Body</parameter>
		</parameter>
	</function>

	<!-- Validate "discard" response from Application to MMS proxy server -->
	<function name="checkHeader" module="HTTP">
		<parameter>X-Proxy-Handle</parameter>
		<parameter>discard</parameter>
	</function>

	<!-- Wait for a MM7 request on the MMSC Server -->
	<function name="waitForRequests" module="MMSC">
		<parameter>1</parameter>
	</function>

	<!-- It's a good Idea to check whether the response is actually a correct MM7 request by validating against the standards -->
	<function name="validateXML" module="XML">
		<variable>MMSCSERVER/MM7/SOAP</variable>
		<parameter></parameter>
		<configuration>MMSCSERVER/XMLNSENV</configuration>
		<configuration>MMSCSERVER/SOAPXSD</configuration>
		<configuration>MMSCSERVER/XMLNSMM7</configuration>
		<configuration>MMSCSERVER/MM7XSD</configuration>
	</function>

	<!-- check MM7 version set correctly in response -->
	<function name="queryText" module="Basic">
		<variable>MMSCSERVER/MM7/SOAP</variable>
		<parameter>dev/null</parameter>
		<parameter>
			<parameter>&lt;MM7Version&gt;5.6.0&lt;/MM7Version&gt;</parameter>
		</parameter>
	</function>

	<!-- Check Subject Decoration -->
	<function name="queryText" module="Basic">
		<variable>MMSCSERVER/MM7/SOAP</variable>
		<parameter>dev/null</parameter>
		<parameter>
			<parameter>&lt;Subject&gt;\{MMSX:F</parameter>
			<configuration>MMSX/ARCHIVE/SENDER/MSISDN1</configuration>
			<parameter>\}This is a test message&lt;/Subject&gt;</parameter>
		</parameter>
	</function>

	<!-- Stop MMSC Server -->
	<function name="stopMMSCServer" module="MMSC"/>
</test>



