<test>
	<name>UnconditionalForwarding.TC.019</name>
    <description>Validate Forwarded word in the MMS Archieve Feature is Operator Configurable and it can be any language including Russian
Test Category: SHOULD
Test Steps:
---------------------------------------------------------------
1. Using Subscriber MMS Extra web portal.
2. The sender original recipient is registered to the MMS archive feature.
3. Operator Configure Forwarded word for original recipients archive .
4. Validate the word configured by operator can be in any language including Russian.
5. Send MM1 Message to MMS Proxy.
6. MMS Proxy should intercept this message and send "New-Message-Intercepted" Request to Application as HTTP GET Request and Content-Type should be set as 200 Kbyte
7. MMS Extra after validating the user and recipient sends a positive response and asks for "send data" to MMS Proxy server.
8. MMS Proxy then sends HTTP post with having body of 200 Kbyte data
9. Application gets forward address for that subscriber through its database and tell Advanced proxy to change the recipient address.
10. Advanced proxy changes the recipient headers
11. Sender credit balance has been checked, if the sender has balance then the billing for the sender happens. Billing for the recipient happens.
12. MM7 submit has been sent to the forward address via MM7-OUT 
13. Application get a 200 ok response.
---------------------------------------------------------------
<!--  Modules Used:
	  1. HTTP
	  2. Remote
	  3. Basic -->
</description> 
	
	<!-- Start MMSC server -->
	<function name="startMMSCServer" module="MMSC"/>

	<!-- Available MSISDN -->
	<configuration>../subscriber_config.xml</configuration>

	<!-- Delete Message Store -->
	<subtest>../deleteMessageStoreAll.xml</subtest>
	
	<!-- Query the name of the active MESSAGE-STORE process -->
	<function name="activeProcessToVar" module="Remote">
		<parameter>MESSAGE-STORE</parameter>
		<parameter>Message_Store_Process_Name</parameter>
	</function>

	<function name="executeRemoteXMSCommand" module="Remote">
        <parameter>run command querier -y 1 -x 0 -o MMSX -p  F.CEE.DB-ACCESS -m com.mobilgw.intf.uds.mor.MmsxService.addServiceArchive subscriberId=5017  serviceEnabled=true</parameter>
    </function>

	<!-- Delete Archive messages -->
	<subtest>../deleteArchiveOld.xml</subtest>

	<!-- Query the name of the active ARCHIVE-OUT process -->
	<function name="activeProcessToVar" module="Remote">
		<parameter>ARCHIVE-OUT</parameter>
		<parameter>ARCHIVE-OUT_Name</parameter>
	</function>

	<!-- Restart process to get latest process log -->
	<function name="executeRemoteXMSCommand" module="Remote">
		<parameter>
			<parameter>restart process </parameter>
			<variable>ARCHIVE-OUT_Name/0</variable>
		</parameter>
	</function>

	<!-- Enable trace for validating Archive message -->
	<function name="executeRemoteXMSCommand" module="Remote">
		<parameter>enable trac -v DELIVERY ARCHIVE-OUT.*.*</parameter>
	</function>

	<!-- Set mandatory headers -->
	<function name="setHeader" module="HTTP">
		<parameter>X-Proxy-Region</parameter>
		<parameter>Siberia</parameter>
	</function>

	<function name="setHeader" module="HTTP">
		<parameter>X-Proxy-Session-Id</parameter>
		<parameter>987654</parameter>
	</function>

	<function name="setHeader" module="HTTP">
		<parameter>X-Proxy-MMS-Message-Type</parameter>
		<parameter>m-send-req</parameter>
	</function>

	<function name="setHeader" module="HTTP">
		<parameter>To</parameter>
		<configuration>MMSX/FORWARD/RECIPIENT/MSISDN17</configuration>
	</function>

	<function name="setHeader" module="HTTP">
		<parameter>X-Proxy-Subscriber-MSISDN</parameter>
		<configuration>MMSX/NOSERVICE/SUBSCRIBER/MSISDN1</configuration>
	</function>

	<!-- Set Subject -->
	<function name="setHeader" module="HTTP">
		<parameter>Subject</parameter>
		<parameter>This is a test message </parameter>
	</function>

	<!-- Send Metadeta  Request to application-->
	<function name="sendGetRequest" module="HTTP">
		<parameter>
			<parameter>http://</parameter>
			<configuration>MMS_Extra/IP</configuration>
			<parameter>:</parameter>
			<configuration>MMS_Extra/PORT</configuration>
			<parameter>/New-Message-Intercepted</parameter>
		</parameter>
	</function>

	<!-- Check response received from application -->
	<function name="checkResponseCode" module="HTTP">
		<parameter>200</parameter>
	</function>

	<!-- Will get response as New-Message-Intercepted-Response where need to validate X-Proxy-Handle as "send-body" and set X-Proxy-Transaction-Id as TransactionID -->
	<function name="checkHeader" module="HTTP">
		<parameter>X-Proxy-Handle</parameter>
		<parameter>send-body</parameter>
	</function>

	<function name="queryText" module="BASIC">
		<variable>HTTP/HEADER/X-Application-Context-Id</variable>
		<parameter>X-Application-Context-Id</parameter>
		<parameter>(.*)</parameter>
	</function>

	<function name="info" module="Basic">
		<parameter>X-Application-Context-Id=</parameter>
		<variable>X-Application-Context-Id</variable>
	</function>

	<function name="setHeader" module="HTTP">
		<parameter>X-Proxy-Region</parameter>
		<parameter>Siberia</parameter>
	</function>

	<function name="setHeader" module="HTTP">
		<parameter>X-Application-Context-Id</parameter>
		<variable>X-Application-Context-Id</variable>
	</function>

	<function name="setHeader" module="HTTP">
         <parameter>Content-Type</parameter>
         <parameter>text/xml; charset="utf-8"; boundary="NextPart_000_0028_01C19839.84698430"</parameter>
    </function>

	<function name="setPostData" module="HTTP">
		<file>mm7req.txt</file>
		<parameter/>
	</function>

	<!-- Send Body to application -->
	<function name="sendPostRequest" module="HTTP">
		<parameter>
			<parameter>http://</parameter>
			<configuration>MMS_Extra/IP</configuration>
			<parameter>:</parameter>
			<configuration>MMS_Extra/PORT</configuration>
			<parameter>/Message-Body</parameter>
		</parameter>
	</function>

	<!-- Validate "discard" response from Application to MMS proxy server -->
	<function name="checkHeader" module="HTTP">
		<parameter>X-Proxy-Handle</parameter>
		<parameter>discard</parameter>
	</function>

	<!-- Wait for a MM7 request on the MMSC Server -->
	<function name="waitForRequests" module="MMSC">
		<parameter>1</parameter>
	</function>

	<!-- It's a good Idea to check whether the response is actually a correct MM7 request by validating against the standards -->
	<function name="validateXML" module="XML">
		<variable>MMSCSERVER/MM7/SOAP</variable>
		<parameter></parameter>
		<configuration>MMSCSERVER/XMLNSENV</configuration>
		<configuration>MMSCSERVER/SOAPXSD</configuration>
		<configuration>MMSCSERVER/XMLNSMM7</configuration>
		<configuration>MMSCSERVER/MM7XSD</configuration>
	</function>

	<!-- check MM7 version set correctly in response -->
	<function name="queryText" module="Basic">
		<variable>MMSCSERVER/MM7/SOAP</variable>
		<parameter>dev/null</parameter>
		<parameter>
			<parameter>&lt;MM7Version&gt;5.6.0&lt;/MM7Version&gt;</parameter>
		</parameter>
	</function>

	<!-- check that the Recipient Forwarding MSISDN set correctly in SOAP response-->
	<function name="queryText" module="Basic">
		<variable>MMSCSERVER/MM7/SOAP</variable>
		<parameter>mytest</parameter>
		<parameter>
		<parameter>&lt;Recipients&gt;(.*)&lt;/Recipients&gt;</parameter>
		</parameter>
	</function>

	<!-- Check for No MMS message stored in Message Store-->
	<function name="executeRemoteXMSCommand" module="Remote">
		<parameter>
			<parameter>run command amocli -k count TI:F.CEE.</parameter>
			<variable>Message_Store_Process_Name</variable>
			<parameter>:AMO</parameter>
		</parameter>
	</function>

	<function name="queryResponse" module="Remote">
		<parameter>amocli: 1 items counted</parameter>
		<parameter>response</parameter>
	</function>

	<!-- Stop MMSC Server -->
	<function name="stopMMSCServer" module="MMSC"/>

	<!-- Execute command to get message info from Archive folder -->
	<function name="executeRemoteXMSCommand" module="Remote">
		<parameter>run command querier -y 1 -x 0 -o MMSX -p  F.CEE.DB-ACCESS -m com.mobilgw.intf.uds.mor.MmsxArchive.getAllItems subscriberId=5017</parameter>
	</function>
	
	<!-- Validation of original Recipient, Message should stored in inbox -->
	<function name="queryResponse" module="Remote">
		<parameter>inbox</parameter>
		<parameter>response</parameter>
	</function> 

	<!-- Validation of Sender, Message status in Outbox -->
	<function name="queryResponse" module="Remote">
		<parameter>FORWARD</parameter>
		<parameter>response</parameter>
	</function>

	<function name="executeRemoteXMSCommand" module="Remote">
        <parameter>run command querier -y 1 -x 0 -o MMSX -p  F.CEE.DB-ACCESS -m com.mobilgw.intf.uds.mor.MmsxService.updateServiceArchive subscriberId=5017  serviceEnabled=false</parameter>
    </function>

</test>